/**
 * Block: Image
 */

.wp-block-image {
	overflow: hidden;

	&.is-style-rounded {
		img {
			border-radius: 9999px;
		}
	}

	&:where(.alignleft, .alignright, .aligncenter) {
		display: table;

		figcaption {
			display: table-caption;
		}
	}

	&.aligncenter {
		text-align: center;
	}

	&.alignwide,
	&.alignfull {
		img {
			width: 100%;
		}
	}
}

/**
 * Block: Gallery
 */

.wp-block-gallery {
	--wp--style--gallery-gap-default: var(--wp--style--block-gap);

	&.has-nested-images { // Use this selector to override WP default layout container CSS.
		align-items: normal;
	}

	.wp-block-image {
		position: relative;
		flex-grow: 1;
		flex-basis: calc( ( 100% - ( ( var(--columns) - 1 ) * var(--wp--style--gallery-gap-default) ) ) / var(--columns) );

		display: flex;
		flex-direction: column;

		img {
			display: block;
			width: 100%;
		}

		&:where(.is-style-default, :not([class*="is-style-"])) {
			figcaption {
				position: absolute;
				left: 0;
				right: 0;
				bottom: 0;
				height: auto;
				max-height: 100%;
				overflow: auto;
				padding: 0.5em;
				background-image: linear-gradient(0deg, rgba(0,0,0,0.7) 0, rgba(0,0,0,0.3) 70%, transparent);
				color: white;
			}
		}

	}

	&.is-cropped {
		align-items: stretch;

		.wp-block-image {
			> *:not(figcaption) {
				flex-grow: 1;
			}

			img {
				height: 100%;
				object-fit: cover;
			}
		}

	}

	&.columns-2 {
		--columns: 2;
	}

	&.columns-default,
	&.columns-3 {
		--columns: 3;
	}

	// On phone and larger devices, gallery will have at least 2 columns
	&:where(.columns-4, .columns-5, .columns-6, .columns-7, .columns-8) {
		--columns: 4;
	}

	@media screen and ( min-width: $breakpoint-phone ) {
		&:where(.columns-5, .columns-6) {
			> * {
				--columns: 3;
			}
		}

		&:where(.columns-7, .columns-8) {
			> * {
				--columns: 4;
			}
		}
	}

	@media screen and ( min-width: $breakpoint-tablet ) {
		&.columns-4 {
			> * {
				--columns: 4;
			}
		}

		&.columns-5 {
			> * {
				--columns: 5;
			}
		}

		&.columns-6 {
			> * {
				--columns: 6;
			}
		}

		&.columns-7 {
			> * {
				--columns: 7;
			}
		}

		&.columns-8 {
			> * {
				--columns: 8;
			}
		}
	}

	&.aligncenter {
		justify-content: center;
	}

	> figcaption {
		flex-basis: 100%;
	}

	@include max-width-for-alignleft-alignright();
}

/**
 * Block: Audio
 */

.wp-block-audio {
	audio {
		width: 100%;
	}
}

/**
 * Block: Cover
 */

.wp-block-cover {
	position: relative;
	min-height: 20rem; // Default
	display: flex;
	justify-content: center;
	align-items: center;
	padding: var(--wp--style--block-gap);
	isolation: isolate;

	background-size: cover;
    background-position: center center;

	@include max-width-for-alignleft-alignright();

	// Parallax
	&.has-parallax {
		background-attachment: fixed;

		// Mobile Safari does not support fixed background attachment properly.
		// See also https://stackoverflow.com/questions/24154666/background-size-cover-not-working-on-ios
		// Chrome on Android does not appear to support the attachment at all: https://issuetracker.google.com/issues/36908439
		@supports (-webkit-overflow-scrolling: touch) {
			background-attachment: scroll;
		}

		// Remove the appearance of scrolling based on OS-level animation preferences.
		@media (prefers-reduced-motion: reduce) {
			background-attachment: scroll;
		}
	}

	&.is-light {
		.wp-block-cover__inner-container {
			color: black;
		}
	}

	:where(p,h1,h2,h3,h4,h5,h6) {
		&:not(.has-text-color) {
			color: inherit;
		}
	}

	&.is-position-top-left {
		align-items: flex-start;
		justify-content: flex-start;
	}
	&.is-position-top-center {
		align-items: flex-start;
		justify-content: center;
	}
	&.is-position-top-right {
		align-items: flex-start;
		justify-content: flex-end;
	}
	&.is-position-center-left {
		align-items: center;
		justify-content: flex-start;
	}
	&.is-position-center-center {
		align-items: center;
		justify-content: center;
	}
	&.is-position-center-right {
		align-items: center;
		justify-content: flex-end;
	}
	&.is-position-bottom-left {
		align-items: flex-end;
		justify-content: flex-start;
	}
	&.is-position-bottom-center {
		align-items: flex-end;
		justify-content: center;
	}
	&.is-position-bottom-right {
		align-items: flex-end;
		justify-content: flex-end;
	}

	&.has-custom-content-position {
		.wp-block-cover__inner-container {
			width: auto;
		}
	}
}

// Background overlay
.wp-block-cover__background {
	position: absolute;
	top: 0;
	left: 0;
	bottom: 0;
	right: 0;
	z-index: 0;
	opacity: 0.5; // Default

	&.has-background-dim {
		// No overlay background color set.
		&:not([class*="-background-color"]) {
			background-color: #000; // Default overlay color
		}

		// Remove background-color when gradient overlay is set.
		&.has-background-gradient {
			background-color: transparent;
		}
	}

	// Overlay opacity
	@for $i from 1 through 10 {
		&.has-background-dim-#{ $i * 10 } {
			opacity: $i * 0.1;
		}
	}
}

// Image background
.wp-block-cover__image-background {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: -1;
	margin: 0;
	padding: 0;
	width: 100%;
	height: 100%;
	max-width: none;
	max-height: none;
	object-fit: cover;
	background-size: cover;
	background-position: center center;
	user-select: none; // Disable selection when background is <img> (no repeat mode)

	&.is-repeated {
		background-repeat: repeat;
		background-size: auto;
	}
}

// Video background
.wp-block-cover__video-background {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	z-index: -1;
	margin: 0;
	padding: 0;
	width: 100%;
	height: 100%;
	max-width: none;
	max-height: none;
	object-fit: cover;
}

// Inner container
.wp-block-cover__inner-container {
	width: 100%;
	z-index: 1;
	color: white;
}

/**
 * Block: File
 */

.wp-block-file {
	&.alignleft {
		text-align: left;
	}

	&.aligncenter {
		text-align: center;
	}

	&.alignright {
		text-align: right;
	}
}

.wp-block-file__button {
	@include button();

	margin-inline-start: 1em;
}

/**
 * Block: Media and Text
 */

.wp-block-media-text {
	/*!rtl:begin:ignore*/
	direction: ltr;
	/*!rtl:end:ignore*/

	display: grid;
	grid-template-columns: 1fr 1fr;
	grid-template-rows: auto;
	grid-template-areas: "media content";
	align-items: center;

	&.has-media-on-the-right {
		grid-template-areas: "content media";
	}

	&.is-vertically-aligned-top {
		align-items: start;
	}

	&.is-vertically-aligned-center {
		align-items: center;
	}

	&.is-vertically-aligned-bottom {
		align-items: end;
	}

	&.is-stacked-on-mobile {
		@media screen and ( max-width: ( $breakpoint-tablet - 0.1px ) ) {
			grid-template-columns: 100% !important; // Use important to override inline style from the block settings
			grid-template-areas: "media" "content"; // Stack media and content
		}
	}
}

.wp-block-media-text__media {
	grid-area: media;
	margin: 0;

	img {
		object-fit: cover;
	}

	.is-image-fill > & {
		align-self: stretch;

		a {
			display: block;
			height: 100%;
		}

		img {
			height: 100%;
		}
	}
}

.wp-block-media-text__content {
	grid-area: content;
	padding: clamp( var(--wp--style--block-gap), 10%, calc( 2 * var(--wp--style--block-gap) ) );
}

/**
 * Block: Video
 */

.wp-block-video {
	video {
		width: 100%;
	}
}

/**
 * Block: Embed
 */

.wp-block-embed {
	@include max-width-for-alignleft-alignright();

	// Supply a min-width when inside a cover block, to prevent it from collapsing.
	.wp-block-cover & {
		min-width: 320px;
		min-height: 240px;
	}
}

.wp-block-embed__wrapper {
	position: relative;
}

.wp-embed-responsive {
	// Add responsiveness to embeds with aspect ratios.
	.wp-has-aspect-ratio {
		.wp-block-embed__wrapper::before {
			content: "";
			display: block;
			padding-block-start: 50%; // Default to 2:1 aspect ratio.
		}

		iframe {
			position: absolute;
			top: 0;
			right: 0;
			bottom: 0;
			left: 0;
			height: 100%;
			width: 100%;
		}
	}

	.wp-embed-aspect-21-9 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 42.85%; // 9 / 21 * 100
		}
	}

	.wp-embed-aspect-18-9 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 50%; // 9 / 18 * 100
		}
	}

	.wp-embed-aspect-16-9 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 56.25%; // 9 / 16 * 100
		}
	}

	.wp-embed-aspect-4-3 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 75%; // 3 / 4 * 100
		}
	}

	.wp-embed-aspect-1-1 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 100%; // 1 / 1 * 100
		}
	}

	.wp-embed-aspect-9-16 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 177.77%; // 16 / 9 * 100
		}
	}

	.wp-embed-aspect-1-2 {
		.wp-block-embed__wrapper::before {
			padding-block-start: 200%; // 2 / 1 * 100
		}
	}
}
